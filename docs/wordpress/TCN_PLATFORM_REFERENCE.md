# TCN Platform Reference

This reference captures every public capability exposed by the TCN Platform plugin, including REST endpoints, WooCommerce integrations, and the full class/method surface area. Pair it with the built-in **TCN Platform → API Tester** screen to explore endpoints without leaving WordPress.

---

## 1. Using the Admin API Tester

1. Navigate to **TCN Platform → API Tester**.
2. Choose an example card and click **Load in tester** to populate the form with a URL, method, headers, and body tailored to the selected endpoint.
3. If the route requires authentication:
   - For WordPress-authenticated endpoints, open the tester in another tab while logged in as the user and paste the `X-WP-Nonce` generated by `wp_create_nonce( 'wp_rest' )` or use the cookies from an authenticated browser session.
   - For Password Login API routes that accept bearer tokens, copy the `api_token` issued by `/login` and send it as `Authorization: Bearer {token}`.
   - For WooCommerce bridges, paste a Base64-encoded `consumer_key:consumer_secret` pair for a key with **Read/Write** permissions.
4. Click **Send Request**. The tester captures the outgoing headers/body and the response status, headers, and body so you can verify behaviour immediately.
5. Use the **View request details** disclosure to copy a cURL-ready JSON payload or tweak headers before retrying.

Every endpoint listed below has a matching preset in the tester, so you can validate authentication, membership upgrades, WooCommerce customer creation, and more without external tools.

---

## 2. REST API Catalogue

### 2.1 Password Login & Session API (`/wp-json/gn/v1/*`)

The password login service powers the mobile authentication flow, rate-limits brute force attempts, and mints bearer tokens for subsequent API calls. All endpoints enforce HTTPS unless the **Login → Allow HTTP on WP_DEBUG sites** toggle is enabled and the request passes the `gn_password_api_allow_dev_http` filter. Each successful authentication response embeds a `user` payload with ID, username, membership metadata, sponsor ID, and optional WooCommerce consumer credentials when `WOOCOMMERCE_CONSUMER_KEY`/`WOOCOMMERCE_CONSUMER_SECRET` constants are defined.

| Route | Method | Auth | Purpose |
| ----- | ------ | ---- | ------- |
| `/login` | POST | Public | Exchange username/email and password for login + API tokens. Applies per-IP + per-identifier rate limiting. |
| `/register` | POST | Public | Create a WordPress account and return the new profile payload. |
| `/forgot-password` | POST | Public | Trigger a core password-reset email and optionally return a verification code. |
| `/reset-password` | POST | Public | Accept a verification code or reset key and set a new password. |
| `/change-password` | POST | Bearer token or logged-in cookie | Validate the current password and set a new one. Refreshes the auth cookie. |
| `/me` | GET | Bearer token issued by `/login` | Resolve the user linked to a bearer token without requiring cookies. |
| `/log` | POST | Public | Proxy arbitrary client logs into the plugin’s activity log. |
| `/discounts/lookup` | POST | Bearer token with `tcn_discount_redemptions` capability | Validate a QR token and return the member + discount context required to complete a redemption. |
| `/discounts/transactions` | POST | Bearer token with `tcn_discount_redemptions` capability | Persist a redeemed discount transaction and snapshot the plan tier + monetary breakdown. |
| `/discounts/history` | GET | Bearer token (member sees personal history, vendor sees outlet history) | Paginate prior redemptions and return aggregated totals for dashboards. |

#### Shared request & response behaviour

* **Rate limiting:** The login endpoint tracks attempts per `{action}:{identifier}:{IP}` using the configured `rate_limit` and `rate_limit_window` values. Excessive failures return `429 gn_rate_limited` until the TTL expires.【F:includes/Auth/PasswordLoginService.php†L158-L205】【F:includes/Auth/PasswordLoginService.php†L508-L548】
* **Token lifetime:** `token` (for one-click WordPress login) and `api_token` (for REST bearer auth) both default to seven days and are stored as WordPress transients with matching expiration timestamps.【F:includes/Auth/PasswordLoginService.php†L186-L209】【F:includes/Auth/PasswordLoginService.php†L560-L599】
* **User payload:** Responses include `id`, `username`, `email`, `display_name`, `first_name`, `last_name`, `membership_level`, `sponsor_id`, and optional `woocommerce` credentials (consumer key/secret + base64 `authorization`).【F:includes/Auth/PasswordLoginService.php†L456-L485】
* **Error format:** Failures are returned as `WP_Error` with descriptive messages and HTTP codes (400 for validation, 401/403 for auth, 404 for unknown users, 409 for conflicts, 429 for rate limiting).【F:includes/Auth/PasswordLoginService.php†L146-L237】【F:includes/Auth/PasswordLoginService.php†L260-L392】

#### `POST /wp-json/gn/v1/login`

* **Purpose:** Authenticate using a WordPress username or email address and password.
* **Request body:**
  * `username` *(string, required)* – WordPress username or email.
  * `password` *(string, required)*.
* **Success response:** `{ success: true, user: {...}, token, api_token, expires_in, auth? }` where `auth.woocommerce` mirrors the constants when present. The `token` supports the `/wp-login.php?action=gn_token_login` redirect flow.
* **Failure cases:**
  * Missing credentials → `400 gn_missing_credentials`.
  * Rate limited → `429 gn_rate_limited`.
  * Invalid credentials → `401 gn_invalid_credentials`.

#### `POST /wp-json/gn/v1/register`

* **Purpose:** Create a standard WordPress user without sending core notification emails.
* **Request body:**
  * `username`, `email`, `password` *(required)*.
  * `first_name`, `last_name` *(optional)*.
* **Success response:** `{ success: true, user: {...} }`. Subsequent hooks assign the default membership level (`blue`), ensure a sponsor, and create a WooCommerce welcome order when applicable.【F:includes/Auth/PasswordLoginService.php†L210-L272】【F:includes/Membership/MembershipModule.php†L143-L210】
* **Failure cases:** Username/email already taken (`409`), invalid input (`400`), or creation errors (`500`).

#### `POST /wp-json/gn/v1/forgot-password`

* **Purpose:** Kick off a password reset via email and optionally provide an out-of-band verification code for the mobile app.
* **Request body:** `username` *(string, required)*, `return_verification_code` *(bool, optional)*.
* **Success response:** `{ success: true, verification_code? }`. Codes are hashed in user meta and expire after the filterable TTL (default 15 minutes).【F:includes/Auth/PasswordLoginService.php†L274-L321】【F:includes/Auth/PasswordLoginService.php†L600-L639】
* **Failure cases:** Always returns success for unknown accounts to avoid user enumeration; only HTTPS violations surface errors (`403 gn_https_required`).

#### `POST /wp-json/gn/v1/reset-password`

* **Purpose:** Finalise a reset using either the verification code issued above or the standard WordPress reset key.
* **Request body:**
  * `login` *(string, required)* – Username or email.
  * `password` *(string, required)* – New password.
  * `verification_code` *(string, optional)* – Mutually exclusive with `key`.
  * `key` *(string, optional)* – Core reset key.
* **Success response:** `{ success: true }` after deleting stored verification metadata.
* **Failure cases:** Missing password (`400`), invalid or expired verification code (`400 gn_invalid_code`), invalid key (`400 gn_invalid_reset_key`), missing token (`400 gn_missing_reset_token`), or unknown user (`404 gn_user_not_found`).【F:includes/Auth/PasswordLoginService.php†L323-L390】

#### `POST /wp-json/gn/v1/change-password`

* **Purpose:** Allow logged-in users (via cookie or bearer token) to change their password after confirming the current password.
* **Request body:**
  * `current_password` *(string, required)*.
  * `password` *(string, required)* – Replacement password.
* **Success response:** `{ success: true }`. Refreshes the WordPress auth cookie so the session stays valid.【F:includes/Auth/PasswordLoginService.php†L392-L452】
* **Failure cases:** Auth missing (`401 gn_not_authenticated`), validation errors (`400 gn_missing_password`), wrong current password (`403 gn_invalid_current_password`).

#### `GET /wp-json/gn/v1/me`

* **Purpose:** Resolve the user linked to an API token issued by `/login`.
* **Headers:** `Authorization: Bearer {api_token}`.
* **Success response:** `{ user: {...} }` using the same payload as `/login`.
* **Failure cases:** Missing/invalid bearer header returns `401 gn_unauth`.

#### `POST /wp-json/gn/v1/log`

* **Purpose:** Forward structured client logs into the plugin’s logger.
* **Request body:**
  * `log_level` *(string, optional, default `info`)*.
  * `log_message` *(string, optional)*.
  * `log_source` *(string, optional, default `mobile-app`)*.
  * `log_params` *(array, optional)* – Additional context stored with the log entry.
* **Success response:** `{ ok: true }` after calling `Support\Logger::log()`.

#### `POST /wp-json/gn/v1/discounts/lookup`

* **Purpose:** Validate a scanned discount QR token before the transaction finalises at the point of sale.
* **Authentication:** `Authorization: Bearer {api_token}` belonging to a vendor account with the `tcn_discount_redemptions` capability. Token issuance follows the standard `/gn/v1/login` flow.
* **Request body:**
  * `qr_token` *(string, required)* – Raw token encoded in the QR code.
  * `vendor_id` *(int, required)* – WordPress user ID of the vendor/outlet performing the lookup. The service cross-checks that the bearer token belongs to the same vendor or an elevated operator.
* **Success response:**
  ```json
  {
    "success": true,
    "member": {
      "id": 123,
      "display_name": "Ada Example",
      "plan_tier": "gold"
    },
    "discount": {
      "token": "...",
      "label": "10% Café Beverage",
      "type": "percentage",
      "value": 0.1,
      "max_uses": 1,
      "expires_at": "2024-08-31T23:59:59+00:00"
    },
    "eligible": true,
    "usage": {
      "uses_today": 0,
      "uses_total": 0
    }
  }
  ```
* **Failure cases:**
  * Invalid/expired QR token → `400 gn_invalid_discount_token`.
  * Vendor mismatch or capability missing → `403 gn_rest_forbidden`.
  * Daily/total limits reached → `409 gn_discount_limit_reached` with contextual metadata.

#### `POST /wp-json/gn/v1/discounts/transactions`

* **Purpose:** Persist a completed discount redemption and update usage counters.
* **Authentication:** Same bearer token requirement as `/discounts/lookup`.
* **Request body:**
  * `qr_token` *(string, required)* – Ensures atomic consumption of the entitlement.
  * `member_id` *(int, required)* – WordPress user ID receiving the discount.
  * `vendor_id` *(int, required)* – Vendor performing the redemption.
  * `gross_amount` *(number, required)* – Pre-discount amount in the site currency.
  * `discount_amount` *(number, required)* – Monetary value of the discount.
  * `net_amount` *(number, required)* – `gross_amount - discount_amount` (validated server-side).
  * `currency` *(string, optional, default site currency)* – ISO 4217 code.
  * `metadata` *(object, optional)* – POS references (register, cashier, notes). Stored as JSON.
* **Success response:**
  ```json
  {
    "success": true,
    "transaction": {
      "id": 987,
      "member_id": 123,
      "vendor_id": 456,
      "plan_tier": "gold",
      "gross_amount": 250,
      "discount_amount": 25,
      "net_amount": 225,
      "currency": "THB",
      "created_at": "2024-07-12T04:15:22+00:00"
    }
  }
  ```
* **Failure cases:**
  * Missing/invalid monetary values → `400 gn_discount_amount_invalid`.
  * Token already consumed → `409 gn_discount_already_redeemed`.
  * Authentication mismatch → `401 gn_not_authenticated` / `403 gn_rest_forbidden`.

#### `GET /wp-json/gn/v1/discounts/history`

* **Purpose:** Surface transaction history and roll-up totals for members and vendors.
* **Authentication:** `Authorization: Bearer {api_token}`. Members see their own transactions; vendors see those tied to their outlets. Admins can pass explicit filters for audits.
* **Query parameters:**
  * `page` *(int, optional, default 1)* and `per_page` *(int, optional, default 25, max 100)*.
  * `member_id`, `vendor_id`, `plan_tier` *(optional)* – Require elevated capability when querying other accounts.
  * `date_start`, `date_end` *(string, optional ISO8601)* – Filter by redemption window.
* **Response:**
  ```json
  {
    "success": true,
    "totals": {
      "count": 42,
      "gross_sum": 10250,
      "discount_sum": 1025,
      "net_sum": 9225
    },
    "transactions": [
      {
        "id": 987,
        "member_id": 123,
        "vendor_id": 456,
        "plan_tier": "gold",
        "gross_amount": 250,
        "discount_amount": 25,
        "net_amount": 225,
        "currency": "THB",
        "created_at": "2024-07-12T04:15:22+00:00"
      }
    ],
    "pagination": {
      "page": 1,
      "per_page": 25,
      "total_pages": 2
    }
  }
  ```
* **Notes:** Responses include `X-WP-Total`/`X-WP-TotalPages` headers plus the `totals` object for quick dashboard KPIs (gross, discount, net).

### 2.2 JWT Compatibility (`/wp-json/jwt-auth/v1/*`)

The upstream **JWT Authentication for WP REST API** plugin exposes REST endpoints that many mobile apps and integrations rely on. TCN Platform now mirrors those routes so you can uninstall the standalone plugin while preserving the same contract.

| Route | Method | Auth | Description |
| --- | --- | --- | --- |
| `/jwt-auth/v1/token` | POST | Public | Exchange a username/password for a signed JWT. |
| `/jwt-auth/v1/token/refresh` | POST | Bearer token | Refresh an existing JWT and receive a new token. |
| `/jwt-auth/v1/token/validate` | POST | Bearer token | Validate a JWT and confirm it is still active. |

#### `POST /wp-json/jwt-auth/v1/token`
* **Body**: `username`, `password` (required).
* **Response**: `{ token, user_email, user_nicename, user_display_name, expires_in }`.
* **Notes**: Mirrors the behaviour of the legacy plugin including filter hooks such as `jwt_auth_token_before_dispatch`.

#### `POST /wp-json/jwt-auth/v1/token/refresh`
* **Headers**: `Authorization: Bearer <token>` (or `token` request parameter).
* **Response**: Same payload as the login endpoint with a newly-issued JWT.
* **Notes**: Accepts expired tokens for refresh as long as the signature remains valid and the user still exists.

#### `POST /wp-json/jwt-auth/v1/token/validate`
* **Headers**: `Authorization: Bearer <token>` (or `token` request parameter).
* **Response**: `{ code: 'jwt_auth_valid_token', message, data: { status: 200 } }` when valid.
* **Notes**: Returns `jwt_auth_expired_token` or `jwt_auth_invalid_token` errors if the JWT is no longer valid.

### 2.3 Profile & Media (`/wp-json/gn/v1/profile/avatar`)

The profile endpoints let authenticated members update their avatar through the REST API. Authentication accepts either the WordPress cookie session or the bearer token issued by `/login`.

#### `POST /wp-json/gn/v1/profile/avatar`

* **Purpose:** Upload an image file, store it in the Media Library, attach it to the current user, and return the updated `/wp/v2/users/me` payload.
* **Authentication:** `rest_require_login` equivalent – cookie session, `X-WP-Nonce`, or bearer token via the `TokenAuthenticator`.
* **Request:** `multipart/form-data` with an `avatar` file field. Optional query/body attributes (`user_id`, `id`, `user`) are normalised to ensure users can only target their own profile.
* **Processing:** Validates upload errors, file type (`image/*`), inserts an attachment, generates image sizes, stores `_gn_profile_avatar_id`, `_gn_profile_avatar_urls`, and `simple_local_avatar` meta, then clears the user cache.【F:includes/Rest/ProfileEndpoints.php†L52-L287】
* **Success response:** REST representation of `/wp/v2/users/me` including merged `avatar_urls` for the generated sizes.【F:includes/Rest/ProfileEndpoints.php†L288-L338】【F:includes/Rest/ProfileEndpoints.php†L400-L427】
* **Failure cases:**
  * Unauthenticated → `401 tcn_rest_unauthorized`.
  * Upload validation issues → `400 tcn_avatar_missing`, `400/413/415 tcn_avatar_upload_error`, or `415 tcn_avatar_invalid_type`.
  * Attempting to upload for another user → `403 tcn_rest_forbidden`.

### 2.4 Membership & MLM (`/wp-json/tcn-mlm/v1/*`, `/wp-json/gn/v1/memberships/*`)

Membership routes expose the member profile, genealogy tree, commission ledger, and upgrade flows. They all reuse the Password Login bearer token via `MembershipModule::rest_require_login()` unless marked public.

| Route | Method | Auth | Purpose |
| ----- | ------ | ---- | ------- |
| `/tcn-mlm/v1/member` | GET | Bearer token or logged-in cookie | Return the member payload, commission summary, and 50-entry ledger sample. |
| `/tcn-mlm/v1/genealogy` | GET | Bearer token or logged-in cookie | Build a recursive sponsor tree for the current user. Optional `depth` query (1–5, default 3). |
| `/tcn-mlm/v1/commissions` | GET | Bearer token or logged-in cookie | Return aggregated commission totals and a 100-entry ledger. |
| `/gn/v1/memberships/plans` | GET | Public | List configured membership levels with currency, Stripe publishable key, pricing, and product IDs. |
| `/gn/v1/memberships/stripe-intent` | POST | Bearer token or logged-in cookie | Create a Stripe Payment Intent when a membership carries a fee. |
| `/gn/v1/memberships/confirm` | POST | Bearer token or logged-in cookie | Promote the user to a new level and record commissions after verifying payment details. |

#### `GET /wp-json/tcn-mlm/v1/member`

Returns:

```
{
  "user": {
    "id": 123,
    "display_name": "Member Example",
    "email": "member@example.com",
    "membership_level": "blue",
    "direct_recruits": 5,
    "sponsor_id": 42
  },
  "commissions": {"total": 10.5, "paid": 4.0, "pending": 6.5},
  "ledger": [ ... up to 50 rows ... ]
}
```

Ledger entries include sponsor/member IDs, level, amount, status, and timestamp.【F:includes/Membership/MembershipModule.php†L332-L365】【F:includes/Membership/MembershipModule.php†L1132-L1158】

#### `GET /wp-json/tcn-mlm/v1/genealogy`

* **Query parameter:** `depth` *(int, optional, 1–5, default 3)*.
* **Response:** Recursive tree nodes with `id`, `name`, `level`, `recruits`, and nested `children` arrays for direct recruits. Nodes beyond the requested depth are omitted.【F:includes/Membership/MembershipModule.php†L345-L365】【F:includes/Membership/MembershipModule.php†L1087-L1131】

#### `GET /wp-json/tcn-mlm/v1/commissions`

Returns `{ summary: {...}, ledger: [...] }` where `summary` mirrors the totals described above and `ledger` lists up to 100 rows ordered by newest first.【F:includes/Membership/MembershipModule.php†L352-L365】【F:includes/Membership/MembershipModule.php†L1132-L1158】

#### `GET /wp-json/gn/v1/memberships/plans`

* **Purpose:** Publish the configured membership catalog to the mobile app.
* **Response:**
  * `currency` *(string)* – Site currency code.
  * `publishableKey`/`publishable_key` *(string)* – Stripe publishable key (duplicate keys for backward compatibility).
  * `plans` *(array)* – Each plan contains `id`, `name`, `fee`/`price`, `formatted_fee`, `currency`, `benefits` (sanitised strings), `commission_direct`, `commission_passive`, `product_id` (mapped WooCommerce product), `amount_minor`, and `requires_payment` (boolean).【F:includes/Membership/MembershipModule.php†L384-L433】

#### `POST /wp-json/gn/v1/memberships/stripe-intent`

* **Purpose:** Create a Stripe Payment Intent before confirming an upgrade.
* **Request body:** `plan` *(string, required)* – Membership slug.
* **Behaviour:**
  * Validates the plan exists and Stripe secret key is configured.
  * Returns `{ plan, requires_payment: false }` when the plan’s fee is zero.
  * Otherwise calls Stripe’s `payment_intents` API and returns the raw response (including `id`, `client_secret`, status, etc.).【F:includes/Membership/MembershipModule.php†L434-L478】

#### `POST /wp-json/gn/v1/memberships/confirm`

* **Purpose:** Finalise the upgrade, optionally verifying a Stripe Payment Intent.
* **Request body:**
  * `plan` *(string, required)*.
  * `payment_intent` *(string, required when the plan has a fee)*.
* **Validation:** Confirms the plan exists, Stripe is configured when needed, the payment intent status is in `succeeded|processing|requires_capture`, the amount and currency match, and the metadata `plan` matches the request. Any mismatch returns a `409` error. Missing auth returns `401`.
* **Success response:** `{ success: true, level: plan }` after assigning the sponsor, updating `_tcn_membership_level`, and recording commissions.【F:includes/Membership/MembershipModule.php†L480-L552】

### 2.5 WooCommerce Bridges (`/wp-json/gn/v1/customers`, `/wp-json/gn/v1/orders`)

These endpoints bridge mobile clients to WooCommerce without exposing the entire WooCommerce REST API. Authentication succeeds when the requester can `manage_woocommerce` or presents a valid consumer key/secret pair (via Basic auth header or `consumer_key`/`consumer_secret` parameters). Keys must have `write` or `read_write` permissions; the user associated with the key is temporarily set as the current user for capability checks.【F:includes/Rest/WooCommerceEndpoints.php†L19-L131】【F:includes/Rest/WooCommerceEndpoints.php†L136-L214】

#### `GET /wp-json/gn/v1/customers`

* **Query parameter:** `email` *(string, required)*.
* **Response:** Normalised customer object with `id`, `email`, `first_name`, `last_name`, and `billing`/`shipping` address arrays (fields: first/last name, company, address lines, city, state, postcode, country, email, phone). Falls back to a WordPress user if no WooCommerce customer record exists.【F:includes/Rest/WooCommerceEndpoints.php†L23-L122】【F:includes/Rest/WooCommerceEndpoints.php†L248-L310】
* **Errors:** Missing email (`400 tcn_missing_email`) or unknown customer (`404 tcn_customer_not_found`).

#### `POST /wp-json/gn/v1/customers`

* **Request body:** Accepts JSON or form-encoded payload with `email` (required), optional `password`, `first_name`, `last_name`, plus `billing` and `shipping` objects (arrays of the address fields above).
* **Behaviour:**
  * Generates a random 24-character password when omitted.
  * Creates the WooCommerce customer (`wc_create_new_customer`), updates profile names, and stores billing/shipping meta via whitelist sanitisation.
  * Returns the normalised customer object with HTTP 201 Created.
* **Errors:** Invalid email (`400 tcn_invalid_email`), duplicate customer (`409 tcn_customer_exists`), or creation failure (propagated `WP_Error`).【F:includes/Rest/WooCommerceEndpoints.php†L68-L204】【F:includes/Rest/WooCommerceEndpoints.php†L312-L374】

#### `POST /wp-json/gn/v1/orders`

* **Request body:**
  * `customer_id` *(int, optional)*.
  * `line_items` *(array, required)* – Each item needs `product_id` and optional `quantity`.
  * `shipping_lines` *(array, optional)* – Each entry may specify `method_id`, `method_title`, `total`, `total_tax`, and `taxes`.
  * `payment_method` *(string, optional)*.
  * `set_paid` *(bool/string, optional, default `true`).
  * `status` *(string, optional, default `completed`).
* **Behaviour:** Creates an order, attaches products via `add_product()`, adds shipping line items, calculates totals, optionally marks the order paid, sets the requested status, and returns `{ id, data }` with HTTP 201. Validation ensures line items exist, product IDs resolve, and customer IDs map to users before creation.【F:includes/Rest/WooCommerceEndpoints.php†L125-L205】【F:includes/Rest/WooCommerceEndpoints.php†L376-L462】
* **Errors:** Missing line items (`400 tcn_missing_line_items`), invalid customer (`400 tcn_invalid_customer`), missing product IDs (`400 tcn_missing_product_id`), or unknown products (`400 tcn_invalid_product`).

## 3. Class & Function Reference

The tables below enumerate every method, its visibility, parameters, return values, and notable hooks/side effects. Methods marked *static* are invoked without an instance.

### 3.1 `tcnapp-connector.php`

| Function | Visibility | Purpose | Parameters | Returns | Notes |
| -------- | ---------- | ------- | ---------- | ------- | ----- |
| `tcn_platform_boot()` | global | Instantiates `TCN\Platform\Plugin` and boots all services. | — | void | Called immediately after plugin includes and autoload registration. |

### 3.2 `TCN\Platform\Autoloader`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `register()` | static | Registers the plugin’s PSR-4-style autoloader with SPL. | — | void | Call occurs during plugin bootstrap. |
| `autoload( string $class )` | static | Loads classes inside the `TCN\Platform` namespace from the `includes/` directory. | `$class` fully qualified name. | void | Skips classes outside the namespace; requires files on demand. |

### 3.3 `TCN\Platform\Plugin`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `__construct()` | public | Creates the module registry (`Support\Modules`). | — | void | Modules default to stored state. |
| `boot()` | public | Loads textdomain, registers services, and triggers `tcn_platform_bootstrapped`. | — | void | Invoked from `tcn_platform_boot()`. |
| `load_textdomain()` | public | Loads translations from `languages/`. | — | void | Hooked to `plugins_loaded`. |
| `register_services()` | protected | Populates `$services` with module instances depending on configuration. | — | void | Adds admin pages only in `is_admin()`. |
| `get_modules()` | public | Provides the `Support\Modules` instance. | — | `Modules` | Used by admin screens to read/write module state. |

### 3.4 Lifecycle Hooks

| Class | Method | Purpose |
| ----- | ------ | ------- |
| `TCN\Platform\Activator` | `activate()` *static* | Ensures options defaults, seeds modules, calls `MembershipModule::activate()`, fires `tcn_platform_activated`, flushes rewrite rules. |
| `TCN\Platform\Deactivator` | `deactivate()` *static* | Fires `tcn_platform_deactivated` and flushes rewrite rules. |

### 3.5 Admin UI

#### `TCN\Platform\Admin\SettingsPage`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `__construct( Modules $modules )` | public | Store module registry for toggles. | `$modules` registry. | void | — |
| `register()` | public | Hooks menu registration and form handling. | — | void | Adds actions `admin_menu`, `admin_init`. |
| `register_menu()` | public | Adds the top-level **TCN Platform** admin menu. | — | void | Uses `add_menu_page()`. |
| `handle_form_submission()` | public | Saves module toggles, login settings, and Stripe keys. | — | void | Validates capability and nonce, fires `tcn_platform_settings_saved`. |
| `render_page()` | public | Outputs the settings screen, module cards, and membership summary table. | — | void | Requires `manage_options` capability. |
| `format_amount( $amount, string $currency )` | protected | Formats currency using WooCommerce helpers when available. | `$amount` mixed, `$currency` code. | string | Falls back to simple string format. |

#### `TCN\Platform\Admin\LogPage`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `register()` | public | Hooks admin menu and log-clear handler. | — | void | Adds actions `admin_menu`, `admin_post_tcn_platform_clear_logs`. |
| `register_menu()` | public | Adds the **Activity Log** submenu. | — | void | — |
| `handle_clear_logs()` | public | Verifies nonce, clears logs, logs the action, redirects back with notice. | — | void | Requires `manage_options`. |
| `render_page()` | public | Renders log table with DataTables markup and notices. | — | void | Shows clear button and table. |
| `format_time( $timestamp )` | protected | Converts a Unix timestamp into the site’s date/time format. | `$timestamp` mixed. | string | Returns em dash when missing. |
| `format_source( string $source )` | protected | Normalises source labels (REST/Plugin). | `$source` | string | Defaults to `ucfirst()`. |
| `render_details( $details )` | protected | Delegates to `render_detail_fragment()` for context payloads. | `$details` mixed | string (HTML) | Output escaped/structured. |
| `render_detail_fragment( $value, int $depth = 0, string $parent_key = '' )` | protected | Recursively renders arrays/objects into definition lists, preserving booleans/numbers/badges. | Various | string (HTML) | Handles JsonSerializable, numeric arrays, badges. |
| `format_detail_label( $key )` | protected | Produces human-readable labels for context keys. | `$key` mixed | string | Maps known keys, fallback to title case. |

#### `TCN\Platform\Admin\ApiTesterPage`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `register()` | public | Adds admin menu registration hook. | — | void | Registers submenu under TCN Platform. |
| `register_menu()` | public | Adds **API Tester** submenu entry. | — | void | — |
| `render_page()` | public | Renders the tester form, handles submissions, displays response metadata, and lists presets. | — | void | Validates capability and nonce; uses `wp_remote_request()`. |
| `prepare_url( string $endpoint )` | protected | Normalises user input into an absolute URL under the current site when relative. | `$endpoint` | string | Supports protocol-relative URLs and raw http(s). |
| `normalize_headers( $headers )` | protected | Converts response headers into a sorted key/value map for display. | `$headers` mixed | `array<string,string>` | Handles `Requests_Utility_CaseInsensitiveDictionary`. |
| `format_body_for_display( string $body )` | protected | Pretty-prints JSON bodies when possible. | `$body` | string | Fallback returns original body. |
| `get_examples()` | protected | Builds preset examples covering every REST endpoint. | — | `array<int,array<string,string>>` | Updated with authentication notes and sample payloads. |
| `abbreviate_url( string $url )` | protected | Collapses full URLs into path/query strings for card captions. | `$url` | string | Returns original when parsing fails. |

#### `TCN\Platform\Admin\Assets`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `register()` | public | Hooks `admin_enqueue_scripts` to load plugin assets. | — | void | — |
| `enqueue_assets()` | public | Enqueues CSS/JS on TCN Platform admin screens, conditionally loads DataTables, localises strings. | — | void | Checks current screen slug before enqueuing. |

### 3.6 Authentication

#### `TCN\Platform\Auth\PasswordLoginService`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `register()` | public | Loads login settings, registers REST routes, enforces CORS, hooks token login handler, and installs class alias. | — | void | Hooks `rest_api_init`, `rest_pre_serve_request`, `login_form_gn_token_login`. |
| `register_compatibility_alias()` | public static | Aliases class to legacy `GN_Password_Login_API`. | — | void | Called even when module disabled to preserve compatibility. |
| `register_routes()` | public | Registers `/login`, `/register`, `/forgot-password`, `/reset-password`, `/change-password`. | — | void | Called during `rest_api_init`. |
| `handle_login( WP_REST_Request $request )` | public | Authenticates credentials, enforces HTTPS, rate limits, issues token or cookies. | `$request` | array or `WP_Error` | Returns payload with `user`, `token`, etc. |
| `handle_register( WP_REST_Request $request )` | public | Creates a user, suppresses new-user emails, populates profile, fires `gn_password_api_user_registered`. | `$request` | array or `WP_Error` | Returns `user` payload. |
| `handle_forgot_password( WP_REST_Request $request )` | public | Initiates reset and optionally returns verification code. | `$request` | array | Never reveals user existence; returns success regardless. |
| `handle_reset_password( WP_REST_Request $request )` | public | Validates code or core reset key, sets new password, clears metadata, fires `gn_password_api_password_reset`. | `$request` | array or `WP_Error` | — |
| `handle_change_password( WP_REST_Request $request )` | public | Validates current password, sets new password, refreshes auth cookies, fires `gn_password_api_password_changed`. | `$request` | array or `WP_Error` | — |
| `filter_pre_serve_request( $served, $result, $request, $server )` | public | Adds CORS headers for `gn/v1` namespace. | Mixed | bool | Called during REST response serving. |
| `handle_token_login()` | public | Consumes transient token, logs user in, redirects (filterable). | — | void | Halts execution with `wp_safe_redirect()`. |
| `prepare_user_payload( WP_User $user )` | protected | Builds REST payload with membership metadata. | `$user` | array | Includes sponsor ID and WooCommerce credentials when available. |
| `get_woocommerce_credentials()` | protected | Returns constants-backed WooCommerce consumer credentials plus Basic header helper. | — | array | Empty when constants missing/blank. |
| `get_user_from_login( string $login )` | protected | Resolves login/email to `WP_User`. | `$login` | `WP_User|null` | Returns null when not found. |
| `maybe_enforce_https( WP_REST_Request $request )` | protected | Blocks non-HTTPS requests unless dev override filter allows. | `$request` | true or `WP_Error` | Uses login settings and `gn_password_api_allow_dev_http` filter. |
| `build_rate_context( string $action, string $identifier )` | protected | Generates transient key, limit, TTL for rate limiting. | `$action`, `$identifier` | array | Combines action, username, IP. |
| `is_rate_limited( array $context )` | protected | Checks if attempts exceed limit. | `$context` | bool | — |
| `increment_rate_limit( array $context )` | protected | Increments transient counter. | `$context` | void | — |
| `reset_rate_limit( array $context )` | protected | Clears rate limit transient. | `$context` | void | — |
| `issue_login_token( int $user_id )` | protected | Generates single-use login token, stores transient. | `$user_id` | array (`token`, `expires_in`) | Filterable lifetime/token generator. |
| `build_token_key( string $token )` | protected | Computes transient key for login tokens. | `$token` | string | — |
| `get_token_transient( string $token )` | protected | Retrieves token metadata from transient. | `$token` | mixed | — |
| `validate_reset_code( int $user_id, string $code )` | protected | Checks stored hash/expiry for verification codes. | `$user_id`, `$code` | bool | Deletes meta on expiry. |
| `get_client_ip()` | protected | Extracts caller IP from server vars with sanitisation. | — | string | Used for rate limiting. |
| `issue_reset_verification_code( int $user_id, int $ttl = 900 )` | public static | Generates verification code, stores hashed meta with expiry. | `$user_id`, `$ttl` | string | Filterable code and TTL via `gn_password_api_generate_reset_code`. |

### 3.7 Membership & MLM

#### `TCN\Platform\Membership\MembershipModule`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `__construct( $modules = null )` | public | Accepts optional container for forward compatibility; module is always enabled. | `$modules` optional | void | — |
| `activate()` | public static | Creates commission table via `dbDelta`, seeds membership products. | — | void | Called on plugin activation. |
| `register()` | public | Hooks sponsor capture, shortcodes, REST routes, WooCommerce integrations, scripts. | — | void | Adds numerous WordPress/WooCommerce actions. |
| `enqueue_public_assets()` | public | Enqueues public CSS on My Account pages or shortcode usage. | — | void | Checks `is_account_page()` and shortcode presence. |
| `register_shortcodes()` | public | Registers `[tcn_member_dashboard]`, `[tcn_genealogy]`, `[tcn_mlm_optin]`. | — | void | — |
| `register_rest_routes()` | public | Adds `tcn-mlm/v1` and membership REST routes. | — | void | Requires login for protected data. |
| `handle_api_registration( int $user_id, WP_REST_Request $request )` | public | Ensures sponsor assignment, default level, customer role, and welcome order for API signups. | `$user_id`, `$request` | void | Hooked to `gn_password_api_user_registered`. |
| `register_account_endpoints()` | public | Adds WooCommerce My Account endpoints for dashboards. | — | void | Called on `init` when WooCommerce present. |
| `register_account_query_vars( array $vars )` | public | Adds endpoint query vars. | `$vars` | array | Filter for WooCommerce query vars. |
| `register_account_menu_items( array $items )` | public | Injects MLM menu items into My Account navigation. | `$items` | array | Returns modified items. |
| `render_member_dashboard_endpoint()` | public | Echoes dashboard markup for My Account endpoint. | — | void | Calls `render_member_dashboard()`. |
| `render_genealogy_endpoint()` | public | Echoes genealogy markup for My Account endpoint. | — | void | Calls `render_genealogy()`. |
| `render_member_dashboard_shortcode()` | public | Returns dashboard markup for shortcode usage. | — | string | Delegates to `render_member_dashboard()`. |
| `render_genealogy_shortcode()` | public | Returns genealogy markup for shortcode usage. | — | string | Delegates to `render_genealogy()`. |
| `render_optin_shortcode()` | public | Outputs opt-in call-to-action. | — | string | Buffer-based HTML snippet. |
| `render_member_dashboard()` | protected | Builds member summary table, stats, and ledger for logged-in user. | — | string | Returns login prompt when unauthenticated. |
| `render_genealogy()` | protected | Generates nested genealogy tree HTML. | — | string | Renders login prompt when unauthenticated. |
| `render_genealogy_node( array $node )` | protected | Recursively renders a single node with children. | `$node` | string | Used by `render_genealogy()`. |
| `rest_get_member_profile( WP_REST_Request $request )` | public | REST callback returning profile, commissions, ledger. | `$request` | array | Requires login. |
| `rest_get_genealogy( WP_REST_Request $request )` | public | REST callback building genealogy tree with optional depth. | `$request` | array | Requires login. |
| `rest_get_commissions( WP_REST_Request $request )` | public | REST callback returning commission summary + ledger. | `$request` | array | Requires login. |
| `rest_require_login()` | public | Permission callback confirming authenticated user. | — | bool | — |
| `rest_get_membership_plans( WP_REST_Request $request )` | public | Public REST callback returning plan details, currency, Stripe key, product IDs, and formatted pricing helpers. | `$request` | array | — |
| `rest_create_stripe_intent( WP_REST_Request $request )` | public | Creates Stripe Payment Intent or returns `requires_payment=false` for free tiers. | `$request` | array or `WP_Error` | Validates plan, Stripe keys, amount. |
| `rest_confirm_membership_upgrade( WP_REST_Request $request )` | public | Validates payment, updates membership, records commissions. | `$request` | array or `WP_Error` | Requires login. |
| `get_membership_products()` | protected | Returns map of membership slugs to WooCommerce product IDs. | — | `array<string,int>` | Queries products with `_tcn_membership_level` meta. |
| `stripe_request( string $method, string $path, array $body, string $secret )` | protected | Performs HTTP call to Stripe API. | HTTP method, endpoint path, body, secret key. | array or `WP_Error` | Normalises errors with friendly messages. |
| `handle_order_completed( int $order_id )` | public | Promotes users when completing membership orders, records commissions. | `$order_id` | void | Hooked to `woocommerce_order_status_completed`. |
| `render_product_level_field()` | public | Adds product data panel field for membership level association. | — | void | Uses `woocommerce_wp_select`. |
| `save_product_level_field( int $product_id )` | public | Persists membership level selection from product edit screen. | `$product_id` | void | Validates against defined levels. |
| `assign_sponsor_from_cookie( int $user_id )` | public | Applies sponsor cookie to new registrations, updates metrics. | `$user_id` | void | Hooked to `user_register`. |
| `ensure_customer_role( int $user_id )` | protected | Ensures App User + WooCommerce `customer` roles exist, removes `subscriber` when redundant. | `$user_id` | void | — |
| `maybe_create_welcome_order( int $user_id, WP_REST_Request $request )` | protected | Auto-creates completed WooCommerce order for Blue tier on API signup. | `$user_id`, `$request` | void | Stores order ID in user meta. |
| `get_membership_product_id( string $level, ?array $products = null )` | protected | Resolves product ID for membership level, with slug fallback. | `$level`, optional product map | int | Prefers mapping from `get_membership_products()`, falls back to known slugs (`blue-membership`, `gold-membership`, etc.). |
| `get_product_id_by_slug( string $slug )` | protected | Finds product by slug. | `$slug` | int | Returns 0 when not found. |
| `ensure_sponsor_assignment( int $user_id )` | protected | Ensures user has sponsor via cookie/default setting, updates metrics. | `$user_id` | void | — |
| `record_commissions( int $member_id, int $order_id, string $level_key )` | protected | Inserts direct and passive commission rows, updates recruit counts. | Member ID, order ID, level key. | void | Writes to custom table. |
| `calculate_direct_commission_amount( string $level_key, int $sponsor_id, array $levels )` | protected | Determines direct commission amount, applying overrides by sponsor level. | `$level_key`, `$sponsor_id`, `$levels` | float | Filterable via `tcn_mlm_direct_commission_amount`. |
| `insert_commission( int $sponsor_id, int $member_id, int $order_id, string $level, float $amount, string $currency )` | protected | Inserts commission row into database. | Various | void | Uses `$wpdb->insert`. |
| `maybe_handle_ancestor_upgrades( int $user_id )` | protected | Walks sponsor chain to evaluate auto-upgrades. | `$user_id` | void | Avoids infinite loops with visited array. |
| `maybe_handle_auto_upgrade( int $user_id )` | protected | Upgrades user based on recruits/network metrics. | `$user_id` | void | Promotes Gold→Platinum, Platinum→Black, sets default Blue. |
| `set_membership_level( int $user_id, string $level )` | protected | Updates user meta for membership level and fires `tcn_mlm_user_level_changed`. | `$user_id`, `$level` | void | No change when already at level. |
| `update_direct_recruits( int $user_id )` | protected | Recalculates recruits and network metrics recursively. | `$user_id` | void | Uses `refresh_network_metrics()`. |
| `refresh_network_metrics( int $user_id, array $visited )` | protected | Updates direct recruit counts and network size for user and sponsors. | `$user_id`, `$visited` | void | Recurses up sponsor chain. |
| `count_network_members( int $user_id, array $visited = array() )` | protected | Counts descendants to populate `_tcn_network_size`. | `$user_id`, `$visited` | int | Avoids cycles. |
| `build_genealogy_tree( int $user_id, int $depth )` | protected | Builds nested array describing genealogy tree to requested depth. | `$user_id`, `$depth` | array | Used by REST and shortcode rendering. |
| `get_commission_summary( int $user_id )` | protected | Aggregates commission totals (total/paid/pending). | `$user_id` | array | Queries custom table with `$wpdb`. |
| `get_commission_ledger( int $user_id, int $limit = 25 )` | protected | Retrieves most recent commission rows. | `$user_id`, `$limit` | array | Returns associative arrays. |
| `prepare_member_payload( WP_User $user )` | protected | Formats user data for REST responses. | `$user` | array | Includes membership level, sponsor, recruits. |
| `maybe_capture_sponsor()` | public | Reads `tcn_sponsor` query parameter, sets secure cookie. | — | void | Runs on `init`; requires headers not sent. |
| `get_sponsor_cookie()` | protected | Retrieves sponsor ID from cookie. | — | int | Returns 0 when missing. |
| `format_currency( float $amount )` | protected | Formats amounts using WooCommerce `wc_price` when available. | `$amount` | string | Falls back to currency code + amount. |
| `get_level_options()` | protected | Builds select options for WooCommerce product field. | — | array | Uses `Options::get_levels()`. |
| `maybe_seed_products()` | protected static | Ensures default membership products exist with fees, metadata. | — | void | Called during activation. |

### 3.8 WooCommerce REST Bridges

#### `TCN\Platform\Rest\WooCommerceEndpoints`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `register()` | public | Hooks REST route registration. | — | void | Adds action `rest_api_init`. |
| `register_routes()` | public | Registers `/customers` (GET/POST) and `/orders` (POST). | — | void | Defines parameter schemas and permission callbacks. |
| `permissions_check( WP_REST_Request $request )` | public | Authorises requests via current user capability or consumer keys. | `$request` | bool or `WP_Error` | Returns descriptive errors for unauthorised access. |
| `authenticate_with_consumer_keys( WP_REST_Request $request )` | protected | Validates WooCommerce consumer key/secret from headers or params. | `$request` | int user ID | Sets current user on success; updates key `last_access`. |
| `extract_consumer_credentials( WP_REST_Request $request )` | protected | Reads Basic auth header or `consumer_key`/`consumer_secret` params. | `$request` | array (`key`, `secret`) | — |
| `safe_hash_equals( string $expected, string $actual )` | protected | Performs timing-safe string comparison. | `$expected`, `$actual` | bool | Uses `hash_equals` when available. |
| `validate_email( $value )` | public | Validation callback for email args. | `$value` | bool | — |
| `sanitize_text_field_nullable( $value )` | public | Allows null values while sanitising strings. | `$value` | string|null | — |
| `validate_object_type( $value )` | public | Ensures argument is array-like (used for address payloads). | `$value` | bool | — |
| `validate_positive_int( $value )` | public | Validates positive integer arguments. | `$value` | bool | — |
| `validate_boolean_value( $value )` | public | Accepts bool/int/string truthy values for `set_paid`. | `$value` | bool | — |
| `get_customer( WP_REST_Request $request )` | public | Resolves customer by email, returning normalised data or 404 error. | `$request` | `WP_REST_Response` or `WP_Error` | Falls back to WordPress user ID. |
| `create_customer( WP_REST_Request $request )` | public | Creates WooCommerce customer, sets profile/meta, returns response with status 201. | `$request` | `WP_REST_Response` or `WP_Error` | Auto-generates password when omitted. |
| `normalize_customer_data( int $user_id )` | protected | Formats customer response structure. | `$user_id` | array | Includes billing/shipping arrays. |
| `update_customer_meta( int $user_id, string $type, array $data )` | protected | Sanitises and stores billing/shipping meta fields. | `$user_id`, `$type`, `$data` | void | Supports email sanitisation. |
| `collect_address_fields( int $user_id, string $type )` | protected | Reads stored billing/shipping fields into array. | `$user_id`, `$type` | array | — |
| `create_order( WP_REST_Request $request )` | public | Creates WooCommerce order, adds line/shipping items, totals, marks paid, returns response 201. | `$request` | `WP_REST_Response` or `WP_Error` | Deletes order and errors if payload invalid. |

### 3.9 Support Utilities

#### `TCN\Platform\Support\Options`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `ensure_defaults()` | public static | Seeds membership levels, general settings, login settings with defaults when missing. | — | void | Used during activation. |
| `get_levels()` | public static | Retrieves membership levels merged with defaults and product pricing overlays. | — | array | Ensures only official tiers remain. |
| `update_levels( array $levels )` | public static | Persists level configuration. | `$levels` | void | — |
| `get_general_settings()` | public static | Returns general settings (currency, default sponsor, Stripe keys) with defaults applied. | — | array | — |
| `update_general_settings( array $settings )` | public static | Stores general settings. | `$settings` | void | — |
| `get_login_settings()` | public static | Retrieves login module settings with defaults. | — | array | — |
| `update_login_settings( array $settings )` | public static | Stores login settings merged with defaults. | `$settings` | void | — |
| `apply_membership_product_fees( array $levels )` | protected static | Overlays WooCommerce product pricing onto level fees. | `$levels` | array | Skips when WooCommerce unavailable. |
| `default_levels()` | public static | Provides canonical level definitions (Blue/Gold/Platinum/Black). | — | array | Used to seed options/products. |
| `default_general_settings()` | public static | Returns default currency, default sponsor, Stripe key placeholders. | — | array | — |
| `default_login_settings()` | public static | Returns default CORS, HTTPS, token, and rate limit settings. | — | array | — |

#### `TCN\Platform\Support\Modules`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `__construct()` | public | Loads stored module state. | — | void | Modules default to stored options merged with defaults. |
| `seed_defaults()` | public static | Stores default module configuration on activation. | — | void | — |
| `get_all()` | public static | Returns merged stored/default module map. | — | array | Used internally and by other classes. |
| `defaults()` | public static | Defines baseline module state (`mlm` true, `auth_login` true). | — | array | — |
| `is_enabled( string $module )` | public | Checks if module enabled (MLM always true). | `$module` | bool | — |
| `set_enabled( string $module, bool $enabled )` | public | Sets module enabled flag, persisting changes. | `$module`, `$enabled` | void | MLM module forced true. |
| `sync( array $modules )` | public | Bulk updates modules from admin submission. | `$modules` | void | Iterates defaults to avoid stray keys. |
| `all()` | public | Returns internal module map. | — | array | Used by settings UI. |

#### `TCN\Platform\Support\ActivityMonitor`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `__construct( array $namespaces = array( 'gn/v1', 'tcn-mlm/v1' ) )` | public | Configures REST namespaces to monitor. | `$namespaces` | void | — |
| `register()` | public | Hooks REST logging and lifecycle events. | — | void | Adds filters/actions for logging. |
| `capture_rest_activity( $response, array $handler, $request )` | public | Logs REST request metadata and scrubbed params for monitored namespaces. | Response, handler array, `WP_REST_Request`. | mixed | Returns original response; logs via `Logger::log()`. |
| `log_plugin_activated()` | public | Logs activation event with version. | — | void | Hooked to `tcn_platform_activated`. |
| `log_plugin_deactivated()` | public | Logs deactivation event with version. | — | void | Hooked to `tcn_platform_deactivated`. |
| `log_settings_saved( array $modules, array $login_settings )` | public | Logs settings changes (enabled modules, login config). | `$modules`, `$login_settings` | void | Hooked to `tcn_platform_settings_saved`. |
| `extract_namespace( string $route )` | protected | Derives namespace (e.g., `gn/v1`) from route. | `$route` | string | Used to filter monitored namespaces. |
| `resolve_status( $response )` | protected | Determines HTTP status code from response or error. | `$response` | int | Defaults to 200 or 500 for errors. |
| `resolve_user()` | protected | Returns current user login or “Guest”. | — | string | Uses `get_current_user_id()`. |
| `get_client_ip()` | protected | Extracts request IP from server vars. | — | string | Validates using `FILTER_VALIDATE_IP`. |
| `scrub_params( $params )` | protected | Recursively redacts sensitive keys (passwords, tokens) and sanitises scalars. | `$params` | array | Returns cleaned data for logging. |
| `normalize_key( string $key )` | protected | Normalises keys for logging (lowercase, restricted chars). | `$key` | string | — |

#### `TCN\Platform\Support\Logger`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `log( string $source, string $message, array $context = array() )` | public static | Records log entry with timestamp and sanitised context. | `$source`, `$message`, `$context` | void | Keeps most recent 200 entries. |
| `get_logs()` | public static | Retrieves stored log entries. | — | array | Returns empty array when unset. |
| `clear()` | public static | Deletes log option. | — | void | Admin log clear uses this. |
| `sanitize_context( array $context )` | protected static | Normalises context keys/values before storage. | `$context` | array | Recursively sanitises. |
| `sanitize_value( $value )` | protected static | Converts scalars, arrays, objects into safe representations. | `$value` | mixed | Keeps booleans/numbers, sanitises strings. |
| `sanitize_key( string $key )` | protected static | Normalises keys for storage. | `$key` | string | Shared with `sanitize_context()`. |
| `sanitize_text( string $text )` | protected static | Sanitises text with WordPress helper. | `$text` | string | — |
| `now()` | protected static | Returns UTC timestamp for log entry. | — | int | Uses `current_time( 'timestamp', true )`. |

#### `TCN\Platform\Support\Updater`

| Method | Visibility | Purpose | Parameters | Returns | Notes |
| ------ | ---------- | ------- | ---------- | ------- | ----- |
| `register()` | public | Integrates with Plugin Update Checker library when available. | — | void | Configurable via constants/filters (`tcn_platform_update_repository_url`, `..._branch`). Enables GitHub release assets. |

---

With this reference and the expanded API tester presets, every endpoint (including WooCommerce bridges) can be exercised in seconds from within WordPress. Combine the method tables with your IDE or code reviews to trace hooks, REST callbacks, and WooCommerce touch points without hunting through the source.
